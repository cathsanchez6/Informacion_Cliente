<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario de Solicitud</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    /* Estilos omitidos por brevedad; utiliza los estilos que ya tienes en tu archivo original */
  </style>
</head>
<body>

  <div class="contenedor-principal">
    <!-- Contenido del formulario omitido por brevedad; utiliza el contenido que ya tienes en tu archivo original -->
  </div>

  <script>
    // Función para generar un nuevo código de solicitud
    let contador = 10001;
    function generarCodigoLocal() {
      const nuevoCodigo = "CI" + contador++;
      document.getElementById("codigoResultado").textContent = nuevoCodigo;
      document.getElementById("codigoInput").value = nuevoCodigo;
    }

    // Función para actualizar las cantidades de rollos y seriales
    function actualizarCantidades() {
      const cajas = parseInt(document.getElementById('cajasInput').value) || 0;
      const rollos = cajas * 36;
      const seriales = cajas * 544;

      document.getElementById('rollosOutput').textContent = rollos;
      document.getElementById('serialesOutput').textContent = seriales;
    }

    // Función para eliminar una fila de dirección
    function removeRow(btn) {
      btn.parentElement.remove();
    }

    // Función para manejar la carga y vista previa del logo
    document.getElementById("logoInput").addEventListener("change", function () {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById("logoPreview").src = e.target.result;
          document.getElementById("archivoNombre").textContent = file.name;
        };
        reader.readAsDataURL(file);
      }
    });

    // Función para subir el logo al servidor
    async function subirLogo() {
      const fileInput = document.getElementById("logoInput");
      const file = fileInput.files[0];

      if (!file) {
        alert("Por favor selecciona un archivo.");
        return;
      }

      const formData = new FormData();
      formData.append("logo", file);

      try {
        const response = await fetch("https://script.google.com/macros/s/AKfycbx39sJlkn_ZncXpLnmi48KqB3Uw2zy9nYQEo2oZwZs_UiUABGgfae0Xgb6igkw5D8jY/exec", {
          method: "POST",
          body: formData
        });

        const result = await response.text();
        alert(result);
      } catch (error) {
        alert("Error al subir el logo.");
        console.error(error);
      }
    }

    // Función para enviar los datos del formulario
    document.getElementById("crearBtn").addEventListener("click", async () => {
      const data = {
        codigo: document.getElementById("codigoResultado").textContent,
        cantidadCajas: document.getElementById("cajasInput").value,
        cantidadRollos: document.getElementById("rollosOutput").textContent,
        seriales: document.getElementById("serialesOutput").textContent,
        sobre: document.getElementById("sobre").value,
        razon: document.getElementById("razon").value,
        nit: document.getElementById("nit").value,
        direccion1: document.querySelectorAll(".form-row input")[0].value,
        telefono1: document.querySelectorAll(".form-row input")[1].value,
        ciudad1: document.querySelectorAll(".form-row input")[2].value,
        direccion2: document.querySelectorAll(".form-row input")[3].value,
        telefono2: document.querySelectorAll(".form-row input")[4].value,
        ciudad2: document.querySelectorAll(".form-row input")[5].value,
        correo: document.getElementById("correo").value,
        web: document.getElementById("pagina").value,
        link: document.getElementById("link").value
      };

      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbx39sJlkn_ZncXpLnmi48KqB3Uw2zy9nYQEo2oZwZs_UiUABGgfae0Xgb6igkw5D8jY/exec", {
          method: "POST",
          body: JSON.stringify(data),
          headers: {
            "Content-Type": "application/json"
          }
        });

        const text = await res.text();
        alert("✅ Solicitud enviada correctamente.");
      } catch (err) {
        alert("❌ Error al enviar la solicitud.");
        console.error(err);
      }
    });

    // Función para cargar el código de solicitud al cargar la página
    window.onload = function () {
      fetch("https://script.google.com/macros/s/AKfycbx39sJlkn_ZncXpLnmi48KqB3Uw2zy9nYQEo2oZwZs_UiUABGgfae0Xgb6igkw5D8jY/exec")
        .then(response => response.text())
        .then(codigo => {
          document.getElementById("codigoResultado").textContent = codigo;
        })
        .catch(error => {
          console.error("Error al generar código:", error);
          document.getElementById("codigoResultado").textContent = "Error al cargar";
        });
    };
  </script>

</body>
</html>
